
## Example for bass management 5.1


## DAC output assignement

L		0
R		1
C		2
SUB		3
LS		4
RS		5

## USB inputs 

Lin			16
Rin			17
Cin			18
LFEin		19
LSin		20
RSin		21

## special outputs to USB host for testing with REW 

REW_LOOP	24	# correspond to input channel 1 in REW menus
REW_HP		25
REW_LP		26
REW_SUM		27
REW_AP		28
REW_SUB		29

## key frequencies for individual crossover (large/small)

F_CROSS		80		# individual crossover large/small
F_LFE		120		# LFE channel limit

## filter for crossover between speakers and SUB

LP_CROSS	LPLR4( F_CROSS )
HP_CROSS	HPLR4( F_CROSS )
AP_CROSS	AP2( F_CROSS, 0.7) AP2( F_CROSS, 0.7)

## low pass for limiting LFE channel

LP_LFE		LPLR4( F_LFE )

## filters definition for each output including PEQ correction (0db by default)

F_L		HPLR4( F_CROSS ) PEAK(1000, 0.7, 0db) PEAK(2000, 0.7, 0db) 
F_R		HPLR4( F_CROSS ) PEAK(1000, 0.7, 0db) PEAK(2000, 0.7, 0db) 
F_C		HPLR4( F_CROSS ) PEAK(1000, 0.7, 0db) PEAK(2000, 0.7, 0db) 
F_LS	HPLR4( F_CROSS ) PEAK(1000, 0.7, 0db) PEAK(2000, 0.7, 0db) 
F_RS	HPLR4( F_CROSS ) PEAK(1000, 0.7, 0db) PEAK(2000, 0.7, 0db) 

F_SUB	PEAK(80, 0.7, 0db) PEAK(100, 0.7, 0db) PEAK(120, 0.7, 0db) PEAK(160, 0.7, 0db) 

## bank of delays given in microseconds to correct speaker distance at listening point

D_L		10
D_R		10
D_C		10
D_SUB	10
D_LS	10
D_RS	10


## progam

core	#in charge of L R C

	input 	Lin
	output	REW_LOOP	# provide a direct feedback/loopback for reference
	biquad 	F_L
	delayus	D_L
	output 	L

	input 	Lin			#this is just to provide an all pass to REW for analysis
	biquad	AP_CROSS
	output	REW_AP
	
	input 	Rin
	biquad 	F_R
	delayus	D_R
	output 	R

	input 	Cin
	biquad 	F_C
	delayus	D_C
	output 	C
	
core	#in charge of LS and RS for sharing workload across cores

	input 	Lin			# this is to provide several feedback to REW during test
	copyxy
	biquad 	HP_CROSS
	output	REW_HP		#provide visibility on the high pass
	swapxy
	biquad 	LP_CROSS
	output	REW_LP		# provide visibility on low pass
	addxy
	output	REW_SUM		#provide visibility on the sum of the LP+HP

	input 	LSin
	biquad 	F_LS
	delayus	D_LS
	output 	LS
	
	input 	RSin
	biquad 	F_RS
	delayus	D_RS
	output 	RS

core	#in charge of LFE output

	input 	Lin			# compute low pass for each speaker
	biquad 	LP_CROSS
	copyxy				# move result in accumulator Y
	
	input 	Rin
	biquad 	LP_CROSS
	addyx				# sum result within accumulator Y
	
	input 	Cin
	biquad 	LP_CROSS
	addyx
	
	input 	LSin
	biquad 	LP_CROSS
	addyx
	
	input 	RSin
	biquad 	LP_CROSS
	addyx				# Y now contains the sum of the 5 low pass of each channel

	input 	LFEin
	gain 	10db		# add the 10db gain as this channel is usually recorded 10db lower
	biquad 	LP_LFE		# apply specific lowpass on LFE
	swapxy				# exhange X and Y
	
	addxy				# add the LFE channel
	biquad 	F_SUB		# apply corrections for final SUB output
	output	REW_SUB		#provide visibility on the SUB output
	delayus	D_SUB
	output 	SUB

end
